# Инструкция по настройке CI/CD с помощью GitHub Actions

Это руководство поможет вам настроить автоматическое развертывание вашего бота на сервер при каждом обновлении кода.

## Принцип работы

Когда вы отправляете изменения в ветку `main` вашего репозитория на GitHub, специальный процесс (GitHub Action) будет автоматически:
1.  Подключаться к вашему серверу по SSH.
2.  Загружать последнюю версию кода.
3.  Перезапускать Docker-контейнеры с ботом.

## Шаг 1: Создание SSH-ключей для GitHub

Чтобы GitHub мог безопасно подключаться к вашему серверу, нужно создать специальную пару SSH-ключей.

1.  **На вашем локальном компьютере** (не на сервере) откройте терминал и выполните команду:
    ```bash
    ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f github-deploy-key -N ""
    ```
    Эта команда создаст два файла: `github-deploy-key` (приватный ключ) и `github-deploy-key.pub` (публичный ключ).

## Шаг 2: Настройка сервера

1.  **Скопируйте публичный ключ на сервер**.
    *   Откройте файл `github-deploy-key.pub` на вашем компьютере и скопируйте его содержимое.

2.  **Добавьте ключ в `authorized_keys` на сервере**.
    *   Подключитесь к вашему серверу по SSH.
    *   Выполните команду, вставив скопированный ключ вместо `[СОДЕРЖИМОЕ_КЛЮЧА]`:
    ```bash
    echo "[СОДЕРЖИМОЕ_КЛЮЧА]" >> ~/.ssh/authorized_keys
    ```
    Теперь ваш сервер будет доверять подключениям, использующим ваш приватный ключ.

## Шаг 3: Настройка секретов в GitHub

Приватный ключ и данные для доступа к серверу — это секретная информация. Ее нужно безопасно сохранить в настройках вашего GitHub-репозитория.

1.  Перейдите в ваш репозиторий на GitHub, откройте `Settings` -> `Secrets and variables` -> `Actions`.

2.  Нажмите `New repository secret` и создайте следующие секреты:

    *   **`SSH_PRIVATE_KEY`**
        *   **Значение**: Содержимое вашего **приватного** ключа (файл `github-deploy-key`). Скопируйте и вставьте все содержимое файла, включая `-----BEGIN RSA PRIVATE KEY-----` и `-----END RSA PRIVATE KEY-----`.

    *   **`SSH_HOST`**
        *   **Значение**: IP-адрес вашего сервера.

    *   **`SSH_USER`**
        *   **Значение**: Имя пользователя, под которым вы подключаетесь к серверу (например, `root`).

    *   **`SSH_HOST_KEY`**
        *   **Значение**: Публичный ключ вашего сервера. Чтобы его получить, выполните на **вашем локальном компьютере** команду:
        ```bash
        ssh-keyscan -H [IP_АДРЕС_ВАШЕГО_СЕРВЕРА]
        ```
        Скопируйте весь вывод этой команды и вставьте его в качестве значения секрета.

## Шаг 4: Отправка изменений в репозиторий

Теперь, когда все настроено, осталось только отправить новые файлы в ваш GitHub-репозиторий.

1.  На вашем локальном компьютере выполните команды:
    ```bash
    git add .github/ CICD_GUIDE.md
    git commit -m "feat: Add CI/CD configuration for deployment"
    git push origin main
    ```

## Готово!

С этого момента каждое изменение, которое вы отправляете в ветку `main`, будет автоматически развертываться на вашем сервере. Вы можете следить за процессом развертывания на вкладке `Actions` в вашем репозитории на GitHub.
