# Аудит видения решения и интеграции с Yandex Cloud (с учетом SberCloud как альтернативы)

## 1. Текущее видение решения

Проект "Telegram AI Bot" нацелен на создание интеллектуального помощника, использующего базу знаний (PDF/TXT/MD) для ответов на вопросы пользователей через Telegram. Ключевая функциональность RAG (Retrieval-Augmented Generation) реализуется посредством Yandex AI Studio (Search Index, Assistant) и YandexGPT. Развертывание и функционирование бота предполагается в Yandex Cloud с использованием современных CI/CD практик.

## 2. Обзор интеграционных точек Yandex Cloud (текущие и планируемые)

На основе анализа документации проекта выявлены следующие ключевые сервисы Yandex Cloud:

*   **AI-сервисы (оплата допустима):** Yandex AI Studio (Search Index, Assistant, Responses API), YandexGPT.
*   **Платные сервисы (требуют анализа):**
    *   Managed PostgreSQL
    *   Object Storage
    *   Lockbox
    *   Container Registry
    *   Serverless Container/Jobs
    *   Cloud Build, Cloud Deploy
    *   Cloud Logging, Cloud Monitoring
    *   DevTools Repositories

## 3. Альтернативная платформа: SberCloud (Cloud.ru)

SberCloud предлагает схожий набор сервисов, которые могут быть использованы для развертывания проекта.

| Сервис Yandex Cloud | Аналог в SberCloud (Cloud.ru) | Примечания |
|---|---|---|
| Yandex AI Studio, YandexGPT | Evolution AI Factory, ML Inference (GigaChat) | Прямой аналог, но с использованием GigaChat вместо YandexGPT. |
| Managed PostgreSQL | Evolution Managed PostgreSQL® | Прямой аналог. |
| Object Storage | Evolution Object Storage (S3) | Полностью совместим с S3 API. |
| Lockbox | Vault | Аналог для хранения секретов. |
| Container Registry | Artifact Registry | Аналог для хранения Docker-образов. |
| Serverless Container/Jobs | Container Apps / FunctionGraph | Container Apps для постоянных приложений, FunctionGraph для serverless-функций (аналог Cloud Functions). |
| Cloud Build, Cloud Deploy | Интеграция с GitHub Actions/GitLab CI | SberCloud предлагает интеграцию с внешними CI/CD системами, а не собственный полный аналог Cloud Build/Deploy. |
| Cloud Logging, Cloud Monitoring | Встроенные инструменты мониторинга и логирования | Прямые аналоги. |
| DevTools Repositories | GitVerse | Собственный Git-репозиторий SberCloud. |

## 4. Сравнение и анализ миграции на SberCloud

### Потенциальные выгоды (Pros):

*   **Доступ к GigaChat:** Миграция позволит использовать GigaChat, что может дать другие результаты в генерации текста по сравнению с YandexGPT. Это может быть как преимуществом, так и недостатком, в зависимости от качества модели для конкретных задач.
*   **Потенциальная экономия:** SberCloud предлагает бесплатные лимиты на некоторые сервисы (Object Storage, FunctionGraph), что может снизить общую стоимость владения, особенно на начальном этапе.
*   **Экосистема Сбера:** Если у проекта есть или планируются другие интеграции с сервисами Сбера, это может упростить взаимодействие.
*   **Фокус на Enterprise:** SberCloud исторически ориентирован на корпоративный сектор, что может означать более высокий уровень SLA и поддержки для крупных клиентов.

### Риски и недостатки (Cons):

*   **Затраты на миграцию:** Перенос существующей инфраструктуры и CI/CD пайплайнов потребует времени и ресурсов. Придется переписать часть кода, связанного с Yandex Cloud SDK, на SberCloud SDK, а также настроить новые CI/CD процессы.
*   **Зрелость и документация:** Yandex Cloud имеет более зрелую и обширную документацию, а также большее сообщество пользователей. У SberCloud документация может быть менее подробной, а поиск решений для нетипичных проблем — сложнее.
*   **Экосистемная привязка:** Переход на SberCloud создаст привязку к их экосистеме, что может усложнить будущие миграции на другие платформы.
*   **CI/CD:** У SberCloud нет прямого аналога Yandex Cloud Build/Deploy как единой связки. Интеграция с GitHub Actions потребует отдельной настройки, включая аутентификацию (хотя это решаемая задача).
*   **Неопределенность с бесплатными аналогами:** Хотя SberCloud предлагает бесплатные лимиты, для полноценной работы проекта (БД, контейнеры, CI/CD) все равно потребуется использование платных сервисов. Заменить все, кроме AI, на полностью бесплатные аналоги, скорее всего, не получится.

## 5. Пошаговый план миграции на SberCloud (для бэклога)

### Фаза 1: Исследование и PoC (Proof of Concept)

*   **Задача 1 (Исследование):** Детально изучить документацию SberCloud по сервисам: Evolution AI Factory, Container Apps, Managed PostgreSQL, Object Storage, Vault.
*   **Задача 2 (PoC - AI):** Создать прототип на Evolution Notebooks для проверки работы GigaChat с базой знаний проекта. Оценить качество ответов.
*   **Задача 3 (PoC - Инфраструктура):** Развернуть базовую инфраструктуру (PostgreSQL, Object Storage) на SberCloud вручную.

### Фаза 2: Настройка инфраструктуры и CI/CD

*   **Задача 4 (IaC):** Начать разработку Terraform-скриптов для управления инфраструктурой на SberCloud (если BL-13 будет принят в работу).
*   **Задача 5 (CI/CD):** Настроить GitHub Actions для сборки Docker-образа и загрузки его в SberCloud Artifact Registry.
*   **Задача 6 (Секреты):** Настроить SberCloud Vault и интегрировать его с CI/CD.

### Фаза 3: Адаптация и миграция приложения

*   **Задача 7 (Код):** Адаптировать код приложения для работы с API SberCloud AI (GigaChat), Object Storage и Managed PostgreSQL.
*   **Задача 8 (Развертывание):** Настроить развертывание контейнера с ботом в SberCloud Container Apps через GitHub Actions.

### Фаза 4: Миграция данных

*   **Задача 9 (Данные):** Написать и протестировать скрипты для миграции данных (документы, метаданные) из Yandex Cloud Object Storage и PostgreSQL в SberCloud.

### Фаза 5: Тестирование и запуск

*   **Задача 10 (Тестирование):** Провести полное E2E-тестирование бота на инфраструктуре SberCloud.
*   **Задача 11 (Запуск):** Переключить DNS (или вебхук Telegram) на новое приложение в SberCloud.
*   **Задача 12 (Мониторинг):** Настроить мониторинг и алерты в SberCloud для нового развертывания.

### Фаза 6: Вывод из эксплуатации

*   **Задача 13 (Отключение):** После успешного перехода и стабилизации работы, отключить и удалить все ресурсы проекта в Yandex Cloud.

---

**Вывод:** Миграция на SberCloud возможна, но сопряжена со значительными трудозатратами. Основной выгодой может стать доступ к GigaChat и потенциальное снижение затрат за счет бесплатных лимитов. Однако, необходимо тщательно взвесить риски, связанные со зрелостью платформы, качеством документации и привязкой к вендору. **Полностью исключить платные сервисы (кроме AI) не получится**, так как для работы приложения все равно потребуются платные вычислительные ресурсы, хранилища и базы данных.