# РСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ Codex CLI РґР»СЏ СЂР°Р±РѕС‚С‹ СЃ РїСЂРѕРµРєС‚РѕРј

Р­С‚РѕС‚ С„Р°Р№Р» РїРѕРјРѕРіР°РµС‚ Р±С‹СЃС‚СЂРѕ СЂР°Р·РІРµСЂРЅСѓС‚СЊ РѕРєСЂСѓР¶РµРЅРёРµ Рё РїСЂРѕРґРѕР»Р¶РёС‚СЊ СЂР°Р±РѕС‚Сѓ СЃ С‚РµР»РµРіСЂР°Рј-Р±РѕС‚РѕРј, РѕР±С‰Р°СЏСЃСЊ СЃРѕ РјРЅРѕР№ С‡РµСЂРµР· Codex CLI.

## 1. РџРѕРґРіРѕС‚РѕРІРєР° Р»РѕРєР°Р»СЊРЅРѕР№ СЃСЂРµРґС‹
1. РЈСЃС‚Р°РЅРѕРІРёС‚Рµ Python 3.11+ Рё Docker.
2. РЎРєР»РѕРЅРёСЂСѓР№С‚Рµ СЂРµРїРѕР·РёС‚РѕСЂРёР№ Рё РїРµСЂРµР№РґРёС‚Рµ РІ РєР°С‚Р°Р»РѕРі `telegram-ai-bot`.
3. РЎРѕР·РґР°Р№С‚Рµ `.env` РЅР° РѕСЃРЅРѕРІРµ `.env.example` (РёР»Рё `.env.prod` РґР»СЏ РѕР±Р»Р°РєР°). РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ С„Р°Р№Р» СЃРѕРґРµСЂР¶РёС‚ СЂРµР°Р»СЊРЅС‹Рµ Р·РЅР°С‡РµРЅРёСЏ С‚РѕРєРµРЅРѕРІ Рё ID:
   ```bash
   cp .env.example .env
   # Р·Р°РїРѕР»РЅРёС‚Рµ TELEGRAM_BOT_TOKEN, DATABASE_URL, YC_* Рё С‚.Рґ.
   ```
4. РЈСЃС‚Р°РЅРѕРІРёС‚Рµ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РґР»СЏ Р»РѕРєР°Р»СЊРЅС‹С… СЃРєСЂРёРїС‚РѕРІ:
   ```bash
   python -m venv .venv
   .venv\Scripts\activate  # Windows
   pip install -r requirements.txt
   ```

## 2. Р—Р°РїСѓСЃРє Codex CLI (РІ РѕС‚РґРµР»СЊРЅРѕРј С‚РµСЂРјРёРЅР°Р»Рµ)
1. РЈСЃС‚Р°РЅРѕРІРёС‚Рµ Codex CLI (РїРѕРґСЂРѕР±РЅРѕСЃС‚Рё Р·Р°РІРёСЃСЏС‚ РѕС‚ РІР°С€РµРіРѕ РѕРєСЂСѓР¶РµРЅРёСЏ; РѕР±С‹С‡РЅРѕ РїРѕСЃС‚Р°РІР»СЏРµС‚СЃСЏ РєР°Рє Р±РёРЅР°СЂСЊ `codex`).
2. Р—Р°РїСѓСЃС‚РёС‚Рµ CLI РІРЅСѓС‚СЂРё РєР°С‚Р°Р»РѕРіР° РїСЂРѕРµРєС‚Р°:
   ```bash
   codex run
   ```
3. Р’ РґРёР°Р»РѕРіРµ СѓРєР°Р¶РёС‚Рµ, С‡С‚Рѕ РЅСѓР¶РЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ С‚РµРєСѓС‰СѓСЋ РїР°РїРєСѓ. Р”Р°Р»РµРµ РІС‹ СЃРјРѕР¶РµС‚Рµ РѕР±С‰Р°С‚СЊСЃСЏ СЃРѕ РјРЅРѕР№, Р° CLI Р±СѓРґРµС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РїРѕРґС…РІР°С‚С‹РІР°С‚СЊ С„Р°Р№Р»С‹ СЂРµРїРѕР·РёС‚РѕСЂРёСЏ.

## 3. РћСЃРЅРѕРІРЅС‹Рµ РєРѕРјР°РЅРґС‹/СЃРєСЂРёРїС‚С‹
- `python check_env.py --env .env --env .env.prod` вЂ” РїСЂРѕРІРµСЂРєР° РѕР±СЏР·Р°С‚РµР»СЊРЅС‹С… РїРµСЂРµРјРµРЅРЅС‹С… РїРµСЂРµРґ Р»СЋР±С‹РјРё РґРµРїР»РѕСЏРјРё.
- `pytest tests/test_smoke.py` вЂ” Р±С‹СЃС‚СЂС‹Р№ smoke-С‚РµСЃС‚ РїРµСЂРµРґ РєРѕРјРјРёС‚РѕРј/РґРµРїР»РѕРµРј.
- `python scripts/diag_report.py` вЂ” С„РѕСЂРјРёСЂРѕРІР°РЅРёРµ РѕС‚С‡С‘С‚Р° РїРѕ `diag_connectivity.py` СЃ СЃРѕС…СЂР°РЅРµРЅРёРµРј РІ `diag_report.md`.
- `python scripts/generate_alert_cli.py --spec monitoring_alerts.yaml` вЂ” РіРµРЅРµСЂР°С†РёСЏ РєРѕРјР°РЅРґ `yc monitoring alert create` РЅР° РѕСЃРЅРѕРІРµ YAML-РѕРїРёСЃР°РЅРёСЏ.
- `python export_lockbox_payload.py --env .env --env .env.prod --output secrets.json` вЂ” РїРѕРґРіРѕС‚РѕРІРєР° payload РґР»СЏ Lockbox.

## 4. РџР°Р№РїР»Р°Р№РЅС‹ Рё РґРµРїР»РѕР№
- `.cloudbuild.yaml` вЂ” РїСЂРёРјРµСЂ РєРѕРЅРІРµР№РµСЂР°: predeploy check в†’ smoke-С‚РµСЃС‚ в†’ docker build/push в†’ `yc deploy release run`.
- `deploy-spec.yaml` вЂ” СЃРїРµС†РёС„РёРєР°С†РёСЏ РґР»СЏ Cloud Deploy; РІРїРёС€РёС‚Рµ СЂРµР°Р»СЊРЅС‹Рµ `container-id`, Lockbox-secretId Рё service-accountId.
- `Yandex_DEVOPS.md` вЂ” РїРѕРґСЂРѕР±РЅС‹Рµ РёРЅСЃС‚СЂСѓРєС†РёРё РїРѕ DevTools Repo, Cloud Build/Deploy Рё СЂРѕР»СЏРј СЃРµСЂРІРёСЃРЅС‹С… Р°РєРєР°СѓРЅС‚РѕРІ.

## 5. Р§С‚Рѕ РїРµСЂРµРґР°С‚СЊ Codex РїСЂРё СЃР»РµРґСѓСЋС‰РµРј Р·Р°РїСѓСЃРєРµ
- РўРµРєСѓС‰РёРµ Р·РЅР°С‡РµРЅРёСЏ `CONTAINER_ID`, `JOB_ID`, `CHANNEL_ID` (РґР»СЏ РЅР°СЃС‚СЂРѕР№РєРё Р°Р»РµСЂС‚РѕРІ).
- Р РµР·СѓР»СЊС‚Р°С‚С‹ `diag_report.md`, РµСЃР»Рё РЅСѓР¶РЅРѕ РїСЂРѕР°РЅР°Р»РёР·РёСЂРѕРІР°С‚СЊ РѕС€РёР±РєРё (РЅР°РїСЂРёРјРµСЂ, РЅРµРґРѕСЃС‚СѓРїРЅРѕСЃС‚СЊ Р‘Р”).
- Р›СЋР±С‹Рµ Р»РѕРіРё/РѕС€РёР±РєРё `docker build/push`, `yc` РєРѕРјР°РЅРґ, С‡С‚РѕР±С‹ СЏ РјРѕРі РїРѕРґСЃРєР°Р·Р°С‚СЊ РґР°Р»СЊРЅРµР№С€РёРµ С€Р°РіРё.

РЎР»РµРґСѓСЏ СЌС‚РёРј С€Р°РіР°Рј, РјРѕР¶РЅРѕ Р±С‹СЃС‚СЂРѕ РІРєР»СЋС‡РёС‚СЊ Codex CLI РІ СЂР°Р±РѕС‡РёР№ С†РёРєР»: РІС‹ РІС‹РїРѕР»РЅСЏРµС‚Рµ РєРѕРјР°РЅРґС‹/СЃРєСЂРёРїС‚С‹ Р»РѕРєР°Р»СЊРЅРѕ, Р° СЏ РїРѕРјРѕРіР°СЋ РїР»Р°РЅРёСЂРѕРІР°С‚СЊ Рё Р°РІС‚РѕРјР°С‚РёР·РёСЂРѕРІР°С‚СЊ СЃР»РµРґСѓСЋС‰РёР№ СЌС‚Р°Рї РјРёРіСЂР°С†РёРё.

Важно: перед запуском CLI обязательно прочитайте README.md — там описаны роли, Agile/TDD/XP-принципы, частота ретроспектив и ссылки на все вспомогательные файлы.
